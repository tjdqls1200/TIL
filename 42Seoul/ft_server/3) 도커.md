### 1. 도커(Docker) 란?

- 도커는 **컨테이너 기반의 오픈소스 가상화 플랫폼**이다.

- **다양한 프로그램, 실행환경을 컨테이너라는 가상 공간으로 추상화**하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해준다.

- **이미지는 컨테이너 실행에 필요한 파일과 설정값등을 하나로 합쳐 이미지화 시킨 것**으로 상태값을 가지지 않고 변하지 않는다 (Immutable). 

- 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장된다. 

- 같은 이미지에서 여러개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 이미지는 변하지 않고 그대로 남아있는다.

  

### 2. 레이어 (Layer)

-  유니온 파일 시스템을 이용하여 **여러개의 레이어를 하나의 파일시스템**으로 사용할 수 있게 해준다.
-  이미지는 여러개의 읽기 전용 read only 레이어로 구성되고 파일이 추가되거나 수정되면 새로운 레이어가 생성된다.
- 레이어는 **도커 이미지가 빌드될 때 Dockerfile에 정의된 명령문(Instructions)을 순서대로 실행하면서 생성**된다.
- 이미지를 빌드할 때마다 이미 생성된 레이어가 캐시 되어 재사용 되기 때문에 **빌드 시간을 단축**할 수 있다.

- **RUN, ADD, COPY 이 3가지 단계만이 레이어로 저장**되고, CMD, LABEL, EXPOSE 등과 같이 메타 데이터를 다루는 부분은 임시 레이어로 생성되지만 저장되지 않아 도커 이미지 사이즈에는 영향을 주지 않는다.

- 레이어 개수를 줄이는 것은 **최적화** 측면에서 도움이 되기 때문에 여러 개로 분리된 명령은 **체이닝(chaining)** 으로 묶는 것이 좋다. (RUN)

  

### 3. 도커파일 (Dockerfile)

- **Dockerfile은 도커 이미지를 만들기 위한 설정 파일**이다. 여러가지 명령어를 토대로 Dockerfile을 작성하면 설정된 내용대로 자동화하여 도커 이미지를 만들 수 있다.
- **FROM** 
  - Dockerfile의 기반이 되는 이미지 레이어 (맨 위에 위치)
  - <이미지 이름>:<태그> 형식으로 작성

- **RUN** 
  - 도커이미지가 생성되기 전에 수행할 쉘 명령어
  - RUN <명령어> - 셀 형식 
    - /bin/sh -c 명령을 이용해서 실행
  - RUN [“명령어1”, “인자1”, “인자22”] – 명령어 형식
    - 필요한 인자들만 정확히 사용할 수 있게 해주며 인자값들은 JSON 방식으로 처리된다.
- **COPY**
  - src에 있는 파일이나 디렉토리를 컨테이너의 dest 경로에 복사한다.
  - ADD와는 원격 URL을 직접 다운로드 하지 않는 다는 것만 다르고 거의 유사하게 작동
  - 단순히 파일이나 디렉토리를 이미지로 복사할때는 COPY를 사용하는게 더 좋다.

- **CMD**

  - 컨테이너가 시작되었을 때 실행할 실행 파일 또는 셸 스크립트
  - 해당 명령어는 DockerFile 내 1번만 사용

- **작성 된 Dockerfile로 Image 만들기**

  - docker build -t [Image name]

    

### 4. 도커 실행 명령어

```txt
docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]
```

| 옵션  | 설명                                                   |
| :---: | :----------------------------------------------------- |
|  -d   | detached mode 흔히 말하는 백그라운드 모드              |
|  -p   | 호스트와 컨테이너의 포트를 연결 (포워딩)               |
|  -v   | 호스트와 컨테이너의 디렉토리를 연결 (마운트)           |
|  -e   | 컨테이너 내에서 사용할 환경변수 설정                   |
| –name | 컨테이너 이름 설정                                     |
|  –rm  | 프로세스 종료시 컨테이너 자동 제거                     |
|  -it  | -i와 -t를 동시에 사용한 것으로 터미널 입력을 위한 옵션 |
| –link | 컨테이너 연결 [컨테이너명:별칭]                        |

